
DROP DATABASE DRDB;

CREATE SCHEMA IF NOT EXISTS `DRDB` ;
USE `DRDB` ;



CREATE TABLE IF NOT EXISTS `DRDB`.`TBEQUIP` (*
  `ID` INT NOT NULL AUTO_INCREMENT,
  `NOME` VARCHAR(45) NULL  NOT NULL,
  `SETOR_ATRIB` INT NOT NULL,
  PRIMARY KEY (`ID`)
);

CREATE TABLE IF NOT EXISTS `DRDB`.`TBCENTROTRABALHO` (*
  `ID` INT NOT NULL AUTO_INCREMENT,
  `NOME` VARCHAR(45) NULL NOT NULL,
  PRIMARY KEY (`ID`)
);

CREATE TABLE IF NOT EXISTS `DRDB`.`TBCAUSADEF` (*
  `ID` INT NOT NULL AUTO_INCREMENT,
  `DSCAUSA` VARCHAR(45) NULL NOT NULL,
  PRIMARY KEY (`ID`)
);

CREATE TABLE IF NOT EXISTS `DRDB`.`TBSINTOMA` (*
  `ID` INT NOT NULL AUTO_INCREMENT,
  `SINTOMA` VARCHAR(45) NULL NOT NULL,
  PRIMARY KEY (`ID`)
);


CREATE TABLE IF NOT EXISTS `DRDB`.`TBLAYOUTOM` (
  `ID` INT NOT NULL AUTO_INCREMENT,
  `NOME` VARCHAR(45) NULL NOT NULL,
  PRIMARY KEY (`ID`)
);


CREATE TABLE IF NOT EXISTS `DRDB`.`TBTIPO` (*
  `ID` INT NOT NULL AUTO_INCREMENT,
  `NOME` VARCHAR(45) NULL NOT NULL,
  PRIMARY KEY (`ID`)
);


CREATE TABLE IF NOT EXISTS `DRDB`.`TBSETOR` (    /* Cadastro de setor */ 
  `ID` INT NOT NULL AUTO_INCREMENT,
  `NOME` VARCHAR(45) NULL NOT NULL,
  PRIMARY KEY (`ID`));



CREATE TABLE IF NOT EXISTS `DRDB`.`TBUSUARIO` (  /* cadastro de usuario */ 
  `ID` INT NOT NULL  AUTO_INCREMENT,
  `IDSAP` INT NOT NULL,
  `LOGIN` VARCHAR(45) NULL NOT NULL,
  `SENHA` VARCHAR(45) NULL NOT NULL,
  `NOME` VARCHAR(45) NULL NOT NULL,
  `CDPERM` INT NOT NULL,
  PRIMARY KEY (`ID`),
      FOREIGN KEY (`CDCT`) REFERENCES `DRDB`.`TBCENTROTRABALHO` (`ID`));


/*
CREATE TABLE IF NOT EXISTS `DR_DB`.`TB_IM` (
  `ID_IM` INT NOT NULL ,
  `DESC_IM` VARCHAR(200)  NULL,
  PRIMARY KEY (`ID_IM`)
  );*/


CREATE TABLE IF NOT EXISTS `DRDB`.`TBOM` ( /* cadastro da OM */
  `ID` INT NOT NULL AUTO_INCREMENT,
  `CDOM` INT NULL DEFAULT NULL,
  `SOLIC` VARCHAR(45) NOT NULL, /* solicitante */
  `TPOM` INT NOT NULL,
  `DSOM` VARCHAR(200) NOT NULL,
  `DTGERACAO` DATETIME NULL DEFAULT NULL,
  `DTBAIXA_MANUT` DATETIME NULL DEFAULT NULL,
  `DTBAIXA_SETOR` DATETIME NULL DEFAULT NULL,
  `DTBAIXA_ADMIN` DATETIME NULL DEFAULT NULL,
  `OBS` VARCHAR(500) NULL DEFAULT NULL,
  `PRIORIDADE` INT NOT NULL,
  `ESTADO` INT NOT NULL,
  `MANU_ATRIB` INT,
  `SETOR_ATRIB` INT NOT NULL,
  PRIMARY KEY (`IDOM`),
    FOREIGN KEY (`SETOR_ATRIB`) REFERENCES `DRDB`.`TBSETOR` (`ID`),
    FOREIGN KEY (`MANU_ATRIB`) REFERENCES `DRDB`.`TBUSUARIO` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

  CREATE TABLE IF NOT EXISTS `DRDB`.`TB_OM_DESC` (       /* Descrições que o manutentor irá colocar na OM */
  `ID` INT NOT NULL AUTO_INCREMENT,
  `IDOM` INT NOT NULL,
  `DESC` VARCHAR(500) NULL,
  `TEMPO_UTIL` TIME DEFAULT NULL,
  PRIMARY KEY (`ID_DESC`),
  FOREIGN KEY (`IDOM`) REFERENCES `DRDB`.`TBOM` (`ID`)
);
/*----------------INSERTS ABAIXO---------------------------------------------------------------------------------------------------------------------*/

INSERT INTO TBSETOR (NOME) VALUES ('GERMAN');


INSERT INTO TBUSUARIO (CDUSUARIO, LOGIN, SENHA, NOME, CDPERMISSAO, TBSETOR_CDSETOR) VALUES (1,'german','123','ADMIN',3, 1);
INSERT INTO TBUSUARIO (CDUSUARIO, LOGIN, SENHA, NOME, CDPERMISSAO, TBSETOR_CDSETOR) VALUES (2,'placido','123','Placido',3, 1);
INSERT INTO TBUSUARIO (CDUSUARIO, LOGIN, SENHA, NOME, CDPERMISSAO, TBSETOR_CDSETOR) VALUES (3,'gabriela','123','Gabriela',3, 1);

INSERT INTO TBOM (CDOM, SOLIC, TPOM, DSOM, DTGERACAO, OBS, PRIORIDADE, ESTADO, MANU_ATRIB, SETOR_ATRIB) VALUES (1, 'DIEGO', 1, 'MAQUINA PARADA', '2019.05.14, 20:00:00', 'TESTE', 1, 1, 1, 1);
INSERT INTO TBOM (CDOM, SOLIC, TPOM, DSOM, DTGERACAO, OBS, PRIORIDADE, ESTADO, MANU_ATRIB, SETOR_ATRIB) VALUES (2, 'GIAN', 2, 'COMPUTADOR', '2019.05.14, 21:00:00', 'TESTE2', 2, 2, 2, 1);
INSERT INTO TBOM (CDOM, SOLIC, TPOM, DSOM, DTGERACAO, OBS, PRIORIDADE, ESTADO, MANU_ATRIB, SETOR_ATRIB) VALUES (3, 'PLACIDO', 2, 'MÁQUINA DA PRODUÇÃO', '2019.05.14, 19:00:00', 'TESTE3', 3, 3,1, 1);
INSERT INTO TBOM (CDOM, SOLIC, TPOM, DSOM, DTGERACAO, OBS, PRIORIDADE, ESTADO, MANU_ATRIB, SETOR_ATRIB) VALUES (4, 'GABRIELA', 1, 'MAQUINA PARADA', '2019.05.14, 18:30:00', 'TESTE4', 2, 4, 2, 1);
INSERT INTO TBOM (CDOM, SOLIC, TPOM, DSOM, DTGERACAO, OBS, PRIORIDADE, ESTADO, MANU_ATRIB, SETOR_ATRIB) VALUES (5, 'RAFAEL', 3, 'PROBLEMA NA MAQUINA DA PRODUÇÃO', '2019.05.14, 20:00:00', 'TESTE5', 1, 2, 3, 1);
INSERT INTO TBOM (CDOM, SOLIC, TPOM, DSOM, DTGERACAO, OBS, PRIORIDADE, ESTADO, SETOR_ATRIB) VALUES (5, 'RAFAEL', 1, 'PROBLEMA NA MAQUINA DA PRODUÇÃO', '2019.05.14, 20:00:00', 'TESTE5', 1, 2, 1);
/*
INSERT INTO TB_IM (ID_IM, DESC_IM) VALUES (1, 'APERTAR PARAFUSO');
INSERT INTO TB_IM (ID_IM, DESC_IM) VALUES (2, 'TROCAR PARAFUSO');
INSERT INTO TB_IM (ID_IM, DESC_IM) VALUES (3, 'TROCAR ÓLEO');*/






